<ng-template #default>
  Loading...
</ng-template>

<div class="text-right row" *ngIf="(itemsResources$  | async )?.customers as customers">

  <div class="clearfix col-12">
    <h5 class="shadow-sm py-2 text-black-50 h2">
      <i class="fa fa-message text-secondary"></i>
      קליינטים
      <span class="btn btn-success btn-sm float-left m-1" routerLink="create">צור לקוח חדש</span>
    </h5>
  </div>

  <div *ngIf="customers.pending && customers.pending.length" class="col-12">
    <app-pending [itemsLists]="customers"></app-pending>
  </div>

  <ng-container *ngTemplateOutlet="tempType; context:{elem: customers}"></ng-container>
</div>


<ng-template #tableCustomers let-resource="elem">

  <div class="table-responsive">
    <table class="table">
      <ng-container [ngTemplateOutlet]="customersTable" [ngTemplateOutletContext]="{res:resource}"></ng-container>
    </table>
  </div>
  <div class="text-center clearfix py-3">
    <pagination-template #p="paginationApi" [id]="resource.config.id"
      (pageChange)="resource.config.currentPage = $event">

      <div class="custom-pagination float-right">
        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
          <i *ngIf="!p.isFirstPage()" (click)="p.previous()" class="fa fa-angle-double-right"></i>
        </div>
        <div class="page-number border" *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value">
          <span (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">{{ page.label }}</span>
          <div *ngIf="p.getCurrent() === page.value">
            <span>{{ page.label }}</span>
          </div>
        </div>
        <div class="pagination-next" [class.disabled]="p.isLastPage()">
          <i *ngIf="!p.isLastPage()" (click)="p.next()" class="fa fa-angle-double-left"></i>
        </div>
      </div>
    </pagination-template>
  </div>
</ng-template>

<!-- Customers Table -->
<ng-template #customersTable let-customersData="res">

  <thead class="thead-light">
    <tr>
      <th scope="col">סוג העסק</th>
      <th scope="col">שם החברה</th>
      <th scope="col">פרסם ב</th>
      <th scope="col">סטטוס</th>
      <th><span class="border-primary">הצג</span></th>
      <th><span class="border-info">משתמש</span></th>
      <th><span class="border-warning">ערוך</span></th>
      <th><span class="border-danger">מחק</span></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let customer of customersData.data | paginate: customersData.config; let idx = index">
      <th scope="row">
        {{customer.customer.businessType == "halls-events"? "אולם אירועים": customer.customer.businessType}}</th>
      <td> {{customer.customer.company}}</td>
      <td>
        <small *ngIf="customer.customer.created_at as dt" class="text-muted">
          {{ dt | dateHebraw:'full' }}
        </small>
      </td>
      <td [ngClass]="customer.customer.confirmed? 'text-success':'text-danger'">
        {{customer.customer.confirmed? "פעיל":  "ממתין"}}
      </td>
      <td><a class="btn btn-primary btn-sm" [routerLink]="customer.customer.id">הצג</a>
      </td>
      <td><a class="btn btn-info btn-sm" [routerLink]="'/dashboard/users-views/'+customer.customer.user_id">משתמש</a>
      </td>
      <td><a class="btn btn-outline-danger btn-sm" [routerLink]="customer.customer.id+'/edit'">ערוך</a></td>
      <td><a class="btn btn-danger btn-sm" (click)="destroy(customer.customer)">מחק</a></td>
    </tr>
  </tbody>
</ng-template>

<ng-template #customersForm>
  <app-dashboard-edit></app-dashboard-edit>
</ng-template>