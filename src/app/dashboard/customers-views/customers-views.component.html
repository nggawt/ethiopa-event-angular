<ng-template #default>
  Loading...
</ng-template>

<div class="text-right row" *ngIf="(itemsResources$  | async )?.customers as customers">

  <div class="clearfix col-12">
    <h5 class="shadow-sm py-2 text-black-50 h2">
      <i class="fa fa-message text-secondary"></i>
      קליינטים
      <span class="btn btn-success btn-sm float-left m-1">צור לקוח חדש</span>
    </h5>
  </div>

  <div *ngIf="customers.pending && customers.pending.length" class="col-12">
    <app-pending [itemsLists]="customers"></app-pending>
  </div>

  <ng-container *ngTemplateOutlet="tempType; context:{elem: customers}"></ng-container>
</div>


<ng-template #tableCustomers let-resource="elem">

  <div class="table-responsive">
    <table class="table">
      <ng-container [ngTemplateOutlet]="customersTable" [ngTemplateOutletContext]="{res:resource}"></ng-container>
    </table>
  </div>

  <div class="text-center clearfix py-3">
    <pagination-template #p="paginationApi" [id]="resource.config.id"
      (pageChange)="resource.config.currentPage = $event">

      <div class="custom-pagination float-right">
        <div class="pagination-previous" [class.disabled]="p.isFirstPage()">
          <i *ngIf="!p.isFirstPage()" (click)="p.previous()" class="fa fa-angle-double-right"></i>
        </div>
        <div class="page-number border" *ngFor="let page of p.pages" [class.current]="p.getCurrent() === page.value">
          <span (click)="p.setCurrent(page.value)" *ngIf="p.getCurrent() !== page.value">{{ page.label }}</span>
          <div *ngIf="p.getCurrent() === page.value">
            <span>{{ page.label }}</span>
          </div>
        </div>
        <div class="pagination-next" [class.disabled]="p.isLastPage()">
          <i *ngIf="!p.isLastPage()" (click)="p.next()" class="fa fa-angle-double-left"></i>
        </div>
      </div>
    </pagination-template>
  </div>
</ng-template>

<!-- Customers Table -->
<ng-template #customersTable let-customersData="res">

  <thead class="thead-light">
    <tr>
      <th scope="col">#</th>
      <th scope="col">שם</th>
      <th scope="col">אימייל</th>
      <th scope="col">כותרת\נושא</th>
      <th scope="col">תוכן\תיאור</th>
      <th scope="col">פלאפון\טלפון</th>
      <th scope="col">סוג העסק</th>
      <th scope="col">שם החברה</th>
      <!-- <th *ngIf="customer.deals" scope="col">מבצעים</th> -->
      <th scope="col">פרסם</th>
      <!-- <th><span class="border-warning">עדכן</span></th> -->
      <th><span class="border-warning">ערוך</span></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let customer of customersData.data | paginate: customersData.config; let idx = index">
      <th scope="row">{{customer.customer.id}}</th>
      <td>{{customer.customer.name}}</td>
      <td>{{customer.customer.email}}</td>
      <td>
        <!-- <label [for]="'customer.customerstitle'+customer.customer.id+idx" class="col-form-label word-break" [title]="customer.customer.title"> -->
        {{customer.customer.title}}

        <!-- </label> -->
        <!-- <input [id]="'customer.customerstitle'+customer.customer.id+idx" class="form-control" type="text"> -->
      </td>
      <td>
        <p [title]="customer.customer.descriptions">
          {{customer.customer.descriptions.length > 15? customer.customer.descriptions.slice(0, 15)+"...": customer.customer.descriptions}}
        </p>
        <ng-container
          *ngTemplateOutlet="viewOrEdit; context:{elem: customer.customer, input: 'descriptions', inputId: 'customer.customerdescriptions'+ customer.customer.id+idx}">
        </ng-container>
      </td>
      <td>
        <!-- <label [for]="'customer.customerstel'+customer.customer.id+idx" class="col-form-label word-break" [title]="customer.customer.tel"> -->
        {{customer.customer.tel}}
        <!-- </label> -->
        <!-- <input [id]="'customer.customerstel'+customer.customer.id+idx" class="form-control" type="tel"> -->
      </td>
      <td>{{customer.customer.businessType == "halls-events"? "אולם אירועים": customer.customer.businessType}}</td>
      <td>
        <!-- <label [for]="'customer.customerscompany'+customer.customer.id+idx" class="col-form-label word-break" [title]="customer.customer.company"> -->
        {{customer.customer.company}}
        <!-- </label> -->
        <!-- <input [id]="'customer.customerscompany'+customer.customer.id+idx" class="form-control" type="text"> -->
      </td>
      <!-- <td *ngIf="customer.customer.deals">{{customer.customer.deals}}</td> -->
      <td>
        {{customer.customer.confirmed? "סטטוס אושר":  "סטטוס ממתין"}}
        <ng-container *ngTemplateOutlet="checkBox; context:{elem: customer.customer}"></ng-container>
      </td>
      <!-- <td><span class="btn btn-outline-warning btn-sm">עדכן</span></td> -->
      <td><span class="btn btn-outline-danger btn-sm" [routerLink]="customer.customer.id+'/edit'">ערוך</span></td><!-- (click)="initForm(customer.customer, customer.customersForm)" -->
    </tr>
  </tbody>
</ng-template>

<ng-template #checkBox let-itemObj="elem">
  <div class="custom-control custom-checkbox">
    <input [id]="itemObj.name+itemObj.id" class="custom-control-input" type="checkbox" [checked]="itemObj.confirmed">

    <label [for]="itemObj.name+itemObj.id" class="custom-control-label">
      {{ itemObj.confirmed? "סרב": "אשר" }}
    </label>
  </div>
</ng-template>

<ng-template #viewOrEdit let-itemObj="elem" let-inputType="input" let-inputId="inputId">

  <label [for]="inputId" class="w-100 col-form-label">

    <a class="text-primary float-right link" (click)="editIem(inputId)">
      {{ itemObj[inputType].trim().length > 15? 'עדכן או הצג תוכן': 'עדכן' }}
    </a>
  </label>
  <textarea class="form-control text-break hide" name="body" [id]="inputId">
        {{ itemObj[inputType].trim() }}
  </textarea>
</ng-template>

<ng-template #customersForm>
  <app-dashboard-edit ></app-dashboard-edit>
</ng-template>