<div *ngIf="user" class="row profile text-right pb-3">
    <div class="col-sm-3">
        <!-- SIDEBAR USERPIC -->
        <div class="row profile-userpic clearfix text-right">
            <div class="col-sm-12 pt-2 pb-2">
                <div class="col-sm-6 float-right">
                    <i class="material-icons" style="font-size: 72px;">person</i>
                    <!-- border-top  img-thumbnail -->
                </div>
                <div class="col-sm-6 float-right">
                    <h3 class="h5">{{ user.name}}</h3>
                </div>
            </div>

        </div>
        <!-- END SIDEBAR USERPIC -->
    </div>
    <div class="col-sm-9">
        <ul class="nav justify-content-end p-0">
            <li class="nav-item">
                <a class="nav-link active" href="#">פעיל</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">דף</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">אירוע</a>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">מושהה</a>
            </li>
        </ul>
    </div>
    <div class="col-sm-12 pb-3">
        <div class="border-bottom"></div>
    </div>
    <div class="col-sm-12">
        <nav>
            <div class="nav nav-tabs shadow-sm" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
                    role="tab" aria-controls="nav-profile" aria-selected="true">
                    פרטים אישיים
                </a>
                <a class="nav-item nav-link" id="nav-page-tab" data-toggle="tab" href="#nav-page" role="tab"
                    aria-controls="nav-page" aria-selected="false">
                    דף
                </a>
                <a class="nav-item nav-link" id="nav-activity-tab" data-toggle="tab" href="#nav-activity" role="tab"
                    aria-controls="nav-activity" aria-selected="false">
                    פעילות
                </a>
                <a class="nav-item nav-link" id="nav-events-tab" data-toggle="tab" href="#nav-events" role="tab"
                    aria-controls="nav-events" aria-selected="false">
                    אירועים
                </a>
                <a class="nav-item nav-link" id="nav-messages-tab" data-toggle="tab" href="#nav-messages" role="tab"
                    aria-controls="nav-messages" aria-selected="false">
                    <span *ngIf="user.messages" class="badge badge-primary">{{ user.messages.length }}</span>
                    <span class="sr-only">unread messages</span>
                    הודעות
                    <!-- <i class="material-icons">
                        message
                    </i> -->
                    <!-- <div class="btn btn-primary btn-sm"> -->
                            
                    <!-- </div> -->
                </a>
                <a class="nav-item nav-link" id="nav-settings-tab" data-toggle="tab" href="#nav-settings" role="tab"
                    aria-controls="nav-settings" aria-selected="false">
                    הגדרות
                </a>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                <h2 class="h4">פרטים אישיים</h2>
                <ul>
                    <li><span class="font-weight-bold">שם פרטי</span> :{{ user.name }}</li>
                    <li><span class="font-weight-bold">אימייל</span> :{{ user.email }}</li>
                    <li><span class="font-weight-bold">פלאפון/טלפון</span> :{{ user.tel }}</li>
                    <li><span class="font-weight-bold">אודות</span> :{{ user.about }}</li>
                    <li>
                        <span class="font-weight-bold">לקוח/בעל עסק</span>:
                        <ul *ngIf="user.customer; else notShow">
                            <li> <span class="font-weight-bold">שם חברה</span> :{{ user.customer['company'] }}
                                <small>{{user.customer['title']}}</small></li>
                            <li><span class="font-weight-bold">סוג העסק</span> :{{ user.customer['businessType'] }}</li>
                            <li><span class="font-weight-bold">איש קשר</span> :{{ user.customer['contact'] }}</li>
                            <li><span class="font-weight-bold"> תיאור</span> :{{ (user.customer['descriptions']?.length > 150)? user.customer['descriptions'].replace(user.customer['descriptions'].slice(user.customer['descriptions'].slice(0, 150).lastIndexOf(',')),
                                '...'): user.customer['descriptions'] }}
                            </li>
                            <!-- (user.customer['descriptions'].length > 120)? (user.customer['descriptions'] | slice:0:120) + '...': user.customer['descriptions']  -->
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="tab-pane fade" id="nav-page" role="tabpanel" aria-labelledby="nav-page-tab">
                <h2 class="h4">דף <span class="text-muted">סטטיסטיקה</span></h2>
                <ul>
                    <!--  class="m-0 p-0" -->
                    <li>הצטרף לאינדקס</li>
                    <li>עבור לדף</li>
                    <li>ביקור אחרון</li>
                    <li>סה"כ מספר צפיות בדף</li>
                    <li>סה"כ צפיות להיום</li>
                    <li>סה"כ צפיות לשבוע</li>
                    <li>סה"כ צפיות לחודש</li>
                </ul>
            </div>
            <div class="tab-pane fade" id="nav-activity" role="tabpanel" aria-labelledby="nav-activity-tab">

                <h2 class="h4">פעילות</h2>
                <ul>
                    <!--  class="m-0 p-0" -->
                    <li>ביקור אחרון</li>
                    <li>פוסטים אחרונים</li>
                    <li>הוספת אירועים</li>
                    <li>צפיות בדפים</li>
                </ul>
            </div>
            <div class="tab-pane fade" id="nav-events" role="tabpanel" aria-labelledby="nav-events-tab">
                <!-- <h2 class="h4">אירועים</h2> -->
                <div class="row">

                    <div class="col-sm-6">
                        <div class="p-3 btn-group btn-group-toggle" data-toggle="buttons">
                            <span>הצג אירועים לפי: </span>
                            <label  class="btn btn-light active"  (click)="daily()">יומי
                                <input type="radio" id="option1" name="options" autocomplete="off">
                            </label>
                            <label  class="btn btn-light"  (click)="weekly()">שבועי
                                <input type="radio" id="option2" name="options" autocomplete="off">
                            </label>
                            <label  class="btn btn-light"  (click)="monthly()">חודשי
                                <input type="radio" id="option3" name="options" autocomplete="off">
                            </label>
                            <label  class="btn btn-light"  (click)="yearly()">שנתי
                                <input type="radio" id="option4" name="options" autocomplete="off">
                            </label>
                        </div>
                        <div class="add-events events"></div>
                    </div>

                    <div class="col-sm-6">

                        <form *ngIf="formEvents" [formGroup]="formEvents" class="p-3 border border-left rounded"
                            (ngSubmit)="onSubmit(formMethod)">
                            <div class="form-group formGroup clearfix">
                                <span class="btn btn-sm btn-success float-left" (click)="createEvents()">צור אירוע
                                    חדש</span>
                            </div>
                            <div class="form-group formGroup">
                                <div class="input">
                                    <input id="date" formControlName="date" type="text" class="d-inline"
                                        autocomplete="off" (click)="fire(date)"
                                        (keyup)="(f.date.valid)?daily(date.value):''" placeholder="בחר תאריך"
                                        [pattern]="datePattern" #date>
                                    <label class="m-0 p-1 float-left" for="datepickr">
                                        <!-- <span style="margin-top: .15em;" class="glyphicon glyphicon-calendar"> </span> -->
                                        <!-- <i class="far fa-calendar-alt"></i> -->

                                        <!-- <i class="material-icons"> perm_contact_calendar</i> -->
                                        <i class="material-icons">date_range</i>
                                        <!-- date_range || close -->
                                    </label>
                                </div>
                                <ng-container
                                    *ngTemplateOutlet="clickedMethods; context:{elem: date, itemMethod: formMethod}">
                                </ng-container>
                            </div>
                            <div id="customGroup">
                                <div class="form-group">
                                    <label for="userEvtName" class="col-form-label">שם</label>
                                    <input type="text" id="userEvtName" class="form-control" formControlName="name" #name>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{elem: name, itemMethod: formMethod}">
                                    </ng-container>

                                    <div *ngIf="f.name.invalid && f.name.touched" class="invalid-feedback d-block">* שדה
                                        חובה</div>
                                </div>
                                <div class="form-group d-block">
                                    <!-- (change)="selectedText(select)" -->
                                    <select name="eventType" id="eventType" formControlName="eventType"
                                        class="form-control" (change)="toggleHidden(select, other)" #select>

                                        <option value="" [selected]="true" disabled>סוג האירוע</option>
                                        <option value="wedding">חתונה</option>
                                        <option value="bar-mitzvah">בר/בת מצווה</option>
                                        <option value="hina">חינה</option>
                                        <option value="other">אחר</option>
                                    </select>
                                    <!-- <span class="validity float-left"></span> -->
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{elem: select, itemMethod: formMethod}">
                                    </ng-container>
                                </div>

                                <div class="form-group">
                                    <label for="other"
                                        [ngClass]="other.hidden? 'col-form-label d-none':'col-form-label d-block'">סוג
                                        אירוע אחר
                                        <span class="btn btn-link btn-sm text-success"
                                            (click)="toggleHidden(other, select)">בחר
                                            מרשימה</span>
                                    </label>
                                    <input type="text" id="other" formControlName="other" hidden class="form-control"
                                        #other>
                                    <div *ngIf="!other.hidden">
                                        <ng-container
                                            *ngTemplateOutlet="clickedMethods; context:{ elem: other, itemMethod: formMethod }">
                                        </ng-container>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="location" class="col-form-label">עיר/מיקום</label>
                                    <input type="text" id="location" class="form-control" formControlName="location"
                                        #location>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{ elem: location, itemMethod: formMethod }">
                                    </ng-container>
                                </div>

                                <div class="form-group">
                                    <label for="address" class="col-form-label">כתובת</label>
                                    <input type="text" id="address" class="form-control" formControlName="address"
                                        #address>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{ elem: address, itemMethod: formMethod }">
                                    </ng-container>
                                </div>
                                <div class="form-group">
                                    <label for="userEvtEmail" class="col-form-label">אימייל</label>
                                    <input type="email" id="userEvtEmail" class="form-control" formControlName="email"
                                        [pattern]="emailPatteren" #email>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{ elem: email, itemMethod: formMethod }">
                                    </ng-container>
                                </div>
                                
                                <div class="form-group">
                                    <label for="time" class="col-form-label">שעה</label>
                                    <input type="time" id="time" class="form-control" formControlName="time"
                                        [pattern]="timePattern" #time>
                                    <!--
                     min="12:00" max="23:00" 
                    <span class="validity"></span>
                  -->
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{ elem: time, itemMethod: formMethod }">
                                    </ng-container>
                                </div>

                                <div class="form-group">
                                    <label for="userEvtPhone" class="col-form-label ">טלפון/פלאפון</label>
                                    <input type="tel" id="userEvtPhone" class="form-control" formControlName="phone"
                                        [pattern]="phoneNum" #phone>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{elem: phone, itemMethod: formMethod}">
                                    </ng-container>
                                </div>

                                <div class="form-group">
                                    <textarea class="form-control" id="description" formControlName="description"
                                        rows="3" placeholder="הוסף הודעה" #description></textarea>
                                    <ng-container
                                        *ngTemplateOutlet="clickedMethods; context:{elem: description, itemMethod: formMethod}">
                                    </ng-container>
                                </div>

                                <div *ngIf="messages && messages['violation']" class="bg-light p-1 ml-1">
                                    <div *ngFor="let message of messages['violation']; let idx = index"
                                        class="bg-light p-1 m-1 d-block">

                                        <p *ngFor="let item of messages['violation'][idx] | keyvalue; let key = index">
                                            <b [ngClass]="'text-danger'">
                                                *
                                                {{ item.key+': ' }}
                                            </b> {{ item.value }}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="btn-group col text-light bg-light">
                                <button class="btn btn-success btn-sm"
                                    type="submit">{{ formMethod == 'update'? 'עדכן הכל':'צור אירוע'}}
                                </button>
                                <a class="btn btn-warning btn-sm" (click)="reset()">אפס</a>
                                <a class="btn btn-danger btn-sm" (click)="close()">בטל וסגור</a>
                                <a *ngIf="formMethod == 'update'" class="btn btn-info btn-sm"
                                    (click)="allTodefault()">שחזר ברירת
                                    מחדל</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="nav-messages" role="tabpanel" aria-labelledby="nav-messages-tab">
                <h2 class="h4">הודעות</h2>
                
                <div *ngIf="user.messages">
                    <!--  class="m-0 p-0" -->
                    <div *ngFor="let message of user.messages; let idx = index" class="row">
                        <dt class="col-sm-3">נושא: 
                            <br />
                            <small>
                                נשלח עי: 
                                {{ message.name }}
                            </small>
                            <br />
                            <small>
                                בתאריך: 
                                {{ message.date | date:'fullDate' }} {{ message.date | date: 'shortTime' }}
                            </small>
                        </dt>
                        <dd class="col-sm-9 m-0"> <p>{{ message.title }} </p></dd>

                        <dt class="col-sm-3">הודעה: </dt>
                        <dd class="col-sm-9 m-0"> <p> {{ message.body }} </p></dd>
                        <div class="col-12"><div class="border"></div></div>
                    </div>
                    <!-- <li *ngFor="let message of user.messages; let idx = index">
                        
                        <p *ngFor="let msg of user.messages[idx] | keyvalue">
                            {{ msg.key }} : {{ msg.value }}
                        </p>
                    </li> -->
                    <li># אין הודעות חדשות</li>
                </div>
            </div>

            <div class="tab-pane fade" id="nav-settings" role="tabpanel" aria-labelledby="nav-settings-tab" #setting>
                <h2 *ngIf="hasClassShow" class="h4">הגדרות</h2>
                <form class="border p-3 rounded" [formGroup]="formSetting" (ngSubmit)="onSubmit()">
                    <!-- class="p-3 border border-left rounded" -->
                    <!-- change password -->
                    <div class="mb-3" id="changePassword" formGroupName="changePassword" #changePassword>
                        <div class="form-group row">
                            <div class="col-sm-12">
                                <h2 class="h5">שנה סיסמה</h2>
                            </div>
                            <label for="currentPassword" class="col col-form-label"> סיסמה נוכחי</label>
                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix">
                                    <input type="password" name="currentPassword" class="col-11" id="currentPassword"
                                        formControlName="currentPassword" min="6" max="12"
                                        placeholder="(מנימום 6 תווים)" required>
                                    <small id="currentPassword" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="newPassword" class="col col-form-label">סיסמה חדשה</label>

                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix">
                                    <input type="password" name="newPassword" id="newPassword" class="col-11"
                                        formControlName="newPassword" min="6" max="12" placeholder=" (מנימום 6 תווים)"
                                        required>
                                    <small id="newPassword" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="passwordConf" class="col col-form-label">אשר סיסמה</label>
                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix clearfix">
                                    <input type="password" name="passwordConf" id="passwordConf" class="col-11"
                                        formControlName="passwordConf" min="6" max="12" placeholder=" (מנימום 6 תווים)"
                                        required>
                                    <small id="passwordConf" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-12 clearfix">
                                <div class="float-left">
                                    <span class="btn btn-outline-success btn-sm" (click)="formSt(changePassword)">
                                        שנה סיסמה
                                    </span>
                                </div>
                            </div>
                            <div *ngIf="messages && displayMessages(changePassword)" class="col-12 clearfix">

                                <div *ngFor="let msgs of messages | keyvalue; let idx = index"
                                    class="col-sm-9 col-lg-10 float-left">
                                    <div class="row">
                                        <p *ngFor="let item of messages[msgs.key] | keyvalue; let idxKey = index"
                                            class="col-6 p-1 mb-1 bg-light">
                                            <b [ngClass]="'text-'+item.value.type" (click)="logItem(item)">
                                                *
                                                {{ msgs.key == "currentPassword"? "סיסמה נוכחית":msgs.key == "newPassword"? "סיסמה חדשה": "אישור סיסמה" }}
                                            </b>
                                            : {{ item.value[msgs.key] || item.value['message']}}
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <!-- change email -->
                    <div class="mb-3" id="changeEmail" formGroupName="changeEmail" #changeEmail>
                        <div class="form-group row">
                            <div class="col-sm-12">
                                <h2 class="h5">שנה אימייל</h2>
                            </div>
                            <label for="currentEmail" class="col col-form-label"> אימייל נוכחי</label>
                            <div class="col-sm-9 col-lg-10">
                                
                                <div class="inputTypeNumber clearfix">
                                    <!-- <div class="input-group-prepend">
                                        <div class="input-group-text">@</div>
                                    </div> -->
                                    <input type="email" name="currentEmail" class="col-11" id="currentEmail"
                                        placeholder="פורמט: name10@email.com" formControlName="currentEmail"
                                        [pattern]="emailPatteren" required>
                                    <small id="currentEmail" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">

                            <label for="newEmail" class="col col-form-label">אימייל חדש</label>
                            <div class="col-sm-9 col-lg-10 clearfix">
                                <div class="inputTypeNumber clearfix">
                                    <input type="email" name="newEmail" id="newEmail" class="col-11"
                                        [pattern]="emailPatteren" formControlName="newEmail" min="6" max="12"
                                        placeholder="פורמט: name10@email.com" required>
                                    <small id="newEmail" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="passwordEmail" class="col col-form-label">סיסמה</label>

                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix">
                                    <input type="password" name="passwordEmail" id="passwordEmail" class="col-11"
                                        formControlName="passwordEmail" min="6" max="12" placeholder="(מנימום 6 תווים)"
                                        required>
                                    <small id="passwordEmail" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">

                            <div class="col-sm-12">
                                <div class="float-left">
                                    <span class="btn btn-outline-success btn-sm" (click)="formSt(changeEmail)">שנה
                                        אימייל</span>
                                </div>
                            </div>
                            <div *ngIf="messages && displayMessages(changeEmail)" class="col-12 clearfix">
                                <div *ngFor="let msgs of messages | keyvalue; let idx = index"
                                    class="col-sm-9 col-lg-10 float-left">
                                    <div class="row">
                                        <p *ngFor="let item of messages[msgs.key] | keyvalue; let idxKey = index"
                                            class="col-6 p-1 mb-1 bg-light">
                                            <b [ngClass]="'text-'+item.value.type" (click)="logItem(item)">
                                                *
                                                {{ msgs.key == "currentEmail"? "אימייל נוכחי":msgs.key == "newEmail"? "אימייל חדש": "סיסמה" }}
                                            </b>
                                            : {{ item.value[msgs.key] || item.value['message'] }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <!-- delete account -->
                    <div class="mb-3" id="deleteAccount" formGroupName="deleteAccount" #deleteAccount>
                        <div class="form-group row">
                            <div class="col-sm-12">
                                <h2 class="h5">מחק חשבון</h2>
                            </div>
                            <label for="delAccountEmail" class="col col-form-label">אימייל</label>
                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix">
                                    <input type="email" name="email" class="col-11" id="delAccountEmail"
                                        [pattern]="emailPatteren" formControlName="delAccountEmail"
                                        placeholder="פורמט: name10@email.com" required>
                                    <small id="delAccountEmail" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="accountPassword" class="col col-form-label">סיסמה</label>

                            <div class="col-sm-9 col-lg-10">
                                <div class="inputTypeNumber clearfix">
                                    <input type="password" name="password" id="accountPassword" class="col-11"
                                        formControlName="accountPassword" min="6" max="12"
                                        placeholder="(מנימום 6 תווים)" required>
                                    <small id="accountPassword" class="validity float-left"></small>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="feedback" class="col col-form-label">משוב</label>
                            <div class="col-sm-9 col-lg-10">
                                <textarea class="form-control" id="feedback" placeholder="משוב"
                                    formControlName="feedback">
                                </textarea>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-12">
                                <div class="float-left">
                                    <span class="btn btn-outline-danger btn-sm" (click)="formSt(deleteAccount)">מחק
                                        חשבון</span>
                                </div>
                            </div>
                            <div *ngIf="messages && displayMessages(deleteAccount)" class="col-12 clearfix">

                                <div *ngFor="let msgs of messages | keyvalue; let idx = index"
                                    class="col-sm-9 col-lg-10 float-left">
                                    <div class="row">
                                        <p *ngFor="let item of messages[msgs.key] | keyvalue; let idxKey = index"
                                            class="col-6 p-1 mb-1 bg-light">
                                            <b [ngClass]="'text-'+item.value.type" (click)="logItem(item)">
                                                *
                                                {{ (msgs.key == "accountPassword")? "סיסמה":(msgs.key == "delAccountEmail")?"אימייל": (msgs.key == "feedback")? "משוב": "error"}}
                                            </b>
                                            : {{ item.value[msgs.key] || item.value['message']}}
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<ng-template #clickedMethods let-elem="elem" let-itemValue="itemValue" let-itemMethod="itemMethod">
    <div class="my-2">

        <a *ngIf="itemMethod == 'update'" class="ml-1 px-2 py-2 my-2 border rounded text-center active"
            (click)="update(elem)">
            <span>
                עדכן
                <i class="material-icons text-success">
                    update
                </i>
            </span>
        </a>
        <a *ngIf="elem.value" class="ml-1 px-2 py-2 my-2 border rounded text-center active" (click)="inputReset(elem)">
            <span>
                נקה
                <i class="material-icons text-warning">
                    clear
                </i>
            </span>
        </a>
        <a *ngIf="itemMethod == 'update'" class="ml-1 px-2 py-2 my-2 border rounded text-center active"
            (click)="default(elem)">
            <span>
                מקור
                <i class="material-icons text-primary">
                    redo
                </i>
            </span>
        </a>
    </div>
    <div *ngIf="messages && messages[elem.id]" class="bg-light p-1 ml-1">
        <p *ngFor="let message of messages[elem.id]" class="bg-light p-1 m-1 d-block">
            <span *ngIf="message[elem.id] || message['message']"
                [ngClass]="message['type'] == 'errors'? 'text-danger': 'text-'+message['type'] ">
                <b>#</b>
                {{ message[elem.id] || message['message'] }}
            </span>
        </p>
    </div>
</ng-template>